<html>
<head>
    <title>Secrets Host</title>

    <link href="https://cdn.jsdelivr.net/npm/tailwindcss/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,700|Sumana:400,700" rel="stylesheet">

    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #171B26;
            color: #B2B3BA;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Sumana', serif;
        }
    </style>
</head>
<body>
    <div class="container mx-auto mt-6 leading-normal text-center">
        <div class="flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512.002 512.002" width="32" height="32"><circle cx="364" cy="140.062" r="32" fill="#FFF"/><path d="M506.478 165.937c-10.68-27.194-30.264-66.431-62.915-98.927-32.535-32.384-71.356-51.408-98.194-61.666-29.464-11.261-62.945-4.163-85.295 18.082l-78.538 78.17c-23.281 23.171-29.991 58.825-16.698 88.72a369.522 369.522 0 0 0 13.395 27.103L5.858 389.793A20 20 0 0 0 0 403.936v88c0 11.046 8.954 20 20 20h88c11.046 0 20-8.954 20-20v-36l36-.001c11.046 0 20-8.954 20-20v-35.999h36c11.046 0 20-8.954 20-20s-8.954-20-20-20h-56c-11.046 0-20 8.954-20 20v35.999l-36 .001c-11.046 0-20 8.954-20 20v36H40V412.22l177.355-177.354a20 20 0 0 0 2.958-24.517c-6.931-11.424-13.298-23.632-18.923-36.285-6.599-14.841-3.237-32.57 8.366-44.119l78.537-78.169c11.213-11.159 28.011-14.718 42.798-9.068 23.222 8.876 56.69 25.214 84.256 52.652 27.735 27.604 44.62 61.567 53.9 85.197a39.716 39.716 0 0 1-8.965 42.687l-79.486 79.114c-11.575 11.519-28.851 14.887-44.016 8.58-12.507-5.202-24.62-11.382-36-18.367-9.413-5.778-21.729-2.83-27.507 6.584-5.778 9.414-2.831 21.73 6.583 27.508 13.152 8.072 27.136 15.207 41.562 21.207 30.142 12.539 64.525 5.8 87.595-17.161l79.486-79.113c22.545-22.439 29.602-56.062 17.979-85.659z" fill="#FFF"/></svg>
            <h1 class="text-grey-lightest tracking-tight ml-4" style="font-family: 'Roboto', sans-serif;">Secrets Host</h1>
        </div>
        <h2 class="text-grey-lightest font-light mb-10 text-sm">Secure secrets exchange with public and private keys</h2>

        <div style="max-width: 800px;" class="mx-auto">
            <div id="step1">
                <form id="public-key-form" method="post">
                    <textarea id="public-key"
                              class="block outline-none w-full border p-4 font-mono"
                              style="border-color: #414667; background-color: #1D202F; height: 300px; color: #B2B3BA;"
                              placeholder="Paste your public key here"
                    ></textarea>
                    <input id="submit-button"
                           type="submit"
                           value="Generate unique URL"
                           class="p-4 mt-4 w-full border outline-none cursor-pointer"
                           style="border-color: #414667; background-color: #1D202F; color: #B2B3BA;">
                </form>
            </div>
            <div id="step2" class="hidden">
                <p>Share the below URL with whomever wants to tell you their secrets.</p>
                <input id="unique-url" type="text" class="w-full p-4 mt-4 border outline-none" style="border-color: #414667; background-color: #1D202F; color: #B2B3BA;">
            </div>
        </div>
    </div>

    <script>
        let step1 = document.getElementById('step1');
        let step2 = document.getElementById('step2');
        let form = document.getElementById('public-key-form');
        let submitButton = document.getElementById('submit-button');
        let uniqueUrlBox = document.getElementById('unique-url');

        form.addEventListener('submit', function (event) {
            event.preventDefault();

            let textarea = document.getElementById('public-key');
            let publicKey = textarea.value;

            textarea.disabled = true;
            submitButton.disabled = true;
            submitButton.value = 'Generating unique URL...';

            fetch('/dev/links', {
                method: 'POST',
                body: JSON.stringify({
                    public_key: publicKey
                })
            }).then(function(response) {
                return response.json();
            }).then(function(link) {
                step1.style.display = 'none';
                step2.style.display = 'block';

                uniqueUrlBox.value = 'https://secrets.host/' + link.uuid;
            });
        });
    </script>
</body>
</html>
